version: '2'
services:

  etcd:
    image: docker.io/microbox/etcd
    container_name: shipyard-etcd-discovery
    restart: always
    volumes:
      - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro
    ports:
      - 4001:4001
      - 7001:7001
    command:
      - -name=discovery

  shipyard-swarm-manager:
    image: swarm
    container_name: shipyard-etcd-swarm-manager
    restart: always
    volumes:
      - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro
    ports:
      - 2376:2375
    expose:
      - 2375
    command:
      - manage
      - --host=tcp://0.0.0.0:2375
      - etcd://192.168.3.25:4001

  shipyard-swarm-agent:
    image: swarm
    container_name: shipyard-etcd-swarm-agent
    restart: always
    volumes:
      - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro
    command:
      - join
      - --addr=192.168.3.25:2375
      - etcd://192.168.3.25:4001

  rethinkdb:
    image: rethinkdb
    container_name: shipyard-etcd-rethinkdb
    restart: always
    volumes:
      - rethinkdb_data:/data
      - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro
    ports:
      - 8082:8080
      - 28015:28015
      - 29015:29015
    expose:
      - 8080
      - 28015
      - 29015

  shipyard:
    image: shipyard/shipyard
    container_name: shipyard-etcd-controller
    restart: always
    volumes:
      - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro
    links:
      - rethinkdb
      - shipyard-swarm-manager:swarm
    ports:
      - 8081:8080
    expose:
      - 8080
    command:
      - server
      - -d
      - tcp://swarm:2375

volumes:
  rethinkdb_data:
    driver: local
